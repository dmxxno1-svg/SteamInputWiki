<<<<<<< Updated upstream
# 第0b章：Steam Input 简介

## 什么是 Steam Input？

Steam Input 最初作为专为 Steam 控制器设计的 API 与配置工具出现，名称也与之相对应。但随着 Valve 将配置器逐步开放给其他控制器，他们改变了命名以避免混淆。如今 Steam Input 不仅支持 Steam 控制器，还支持 Xbox 控制器、Sony 的 DualShock 4、DualShock 3（需要 psnow 服务的驱动）、新一代 DualSense、Switch Pro 控制器以及许多第三方变体。它也支持使用 DInput 的通用控制器，但用户通常需要先把输入映射到对应的 Xbox 控制器输入，才能进行重绑定。

它是 Steam 平台的一部分软件工具：当连接受支持的控制器并启用支持后，Steam Input 是一个功能强大的控制器重绑定套件，通过配置你可以用单个控制器来操作整个电脑。

Steam Input 有两个部分：一是键盘/鼠标与手柄的模拟（emulation），二是开发者可以在其游戏中实现以获得更紧密控制支持的输入 API。

我们先从第一个部分说起。

## 对玩家而言，Steam Input 最基本的意义是什么？

对玩家/用户来说，Steam Input 在最基础的层面上解决了许多 PC 控制器兼容性问题。过去我不得不使用 MotioninJoy，后来又用到 SCPToolkit 来让 DualShock 3 在 PC 上工作。这些工具在当时有效，但有时很不稳定。如今的替代方案更多更好，但各有优缺点。

在简便性方面，Steam Input 的优势在于：如果你在 PC 上玩游戏，很可能已经安装了 Steam；启用支持后，你的控制器基本上能直接工作，不再需要额外程序。

Steam Input 的功能远不止基础支持。正如前述，Steam Input 配置器允许你为控制器制作配置文件：包括桌面配置（用于一般电脑操作）、Big Picture 配置（用于 Steam 的 Big Picture 模式）、按游戏的每个进程保存的配置，以及当按住指南（Guide/Home）按钮时切换到的全局“Guide Chord”（向导和组合）配置。每种配置类型在第 01 章会有详述。

通过这些配置文件，Steam Input 允许你在电脑的各个使用场景下用控制器完成大部分操作。

不过它也有两个潜在的缺点：

第一，它需要 Steam 运行，并且你的游戏通常需要通过 Steam 启动。虽然这并不意味着你不能在其他商店购买游戏——你可以把游戏添加到 Steam 并从 Steam 启动它——但这对部分用户可能是个不便。

第二，有一些游戏根本无法与 Steam Input 一起工作。要理解原因而不进入过深的技术细节：Steam Overlay 需要能够 hook（钩入）到游戏，并且游戏需要接受软件输入。

有的游戏不允许 Overlay 钩入，因此 Steam Input 无法生效。针对这类情况，第 09 章将讨论一些解决办法。

更令人头疼的是，有些游戏不接受软件输入，最著名的例子是 Valorant，这类游戏事实上阻止了 Steam Input 的工作。对于这种情况，基本上没有办法。

## 对开发者而言，Steam Input 的基本意义是什么？

首先对开发者说一句：

如果 Steam Deck 如所期待那样流行，那么请确保 Steam Overlay 能够钩入你的游戏并支持 SendInput。如果像 Valorant 那样拒绝软件输入，那么 Deck 用户将无法在便携场景下玩该游戏。若你认为你的玩家希望在 Deck 上游玩你的游戏，请不要像 Valorant 那样。

总体来说，如果你在 Steam 上发布，那么借助 Steam Input 你不必过度担心为各种控制器做原生支持——至少不会像没有 Steam Input 时那样繁琐。当然，若想尽可能兼容，仍建议提供原生手柄支持，以便没有启用 Steam Input 的用户也能获得良好体验。

为了更好地配合 Steam Input，你可以考虑：

* 允许玩家选择用于按钮提示的图形集（glyph），或者直接从 Steam 拉取图形集（在某些情况下可在不实现 API 的情况下实现）；
* 支持混合输入（mixed input），例如同时使用 XInput 与鼠标输入。

这些做法有助于玩家更顺畅地使用 Steam Input。

但是！Steam Input 还有更深的一层。

## API（SIAPI）

Valve 还为 Steam Input 的配置器配套了一个完整的输入 API，称为 Steam Input API（简称 SIAPI）。API 是开发者可以在游戏中实现的一套工具，用以响应并管理玩家输入。另一个常见的输入 API 示例是 XInput（Xbox 控制器输入），它在 PC 游戏中非常普遍。

为了理解 SIAPI，我们先简单回顾 XInput。

XInput 定义了一组固定的按键和模拟控制：ABXY、方向键、两个摇杆、两个肩键、两个扳机、开始/选择/主页。开发者在游戏中实现 XInput 后，游戏可以识别这些输入，但由开发者决定每个输入的功能（例如把 A 绑定为“跳跃”）。

SIAPI 的工作方式有些相反：它更像是把游戏中的动作或输入风格定义出来（例如定义“跳跃”这个动作），然后允许这些动作被绑定到任何类型的按键或触发器上。也就是说，“跳跃”是一个动作，而不是绑定在特定的物理按键上。

这看起来变化不大，但影响深远，我认为 SIAPI 在很多方面优于 XInput。

### 对玩家的好处

在非 SIAPI 的情形下，玩家若使用外部重绑定工具来自定义控制器，通常面临两种选择：
A）受限于游戏内通常非常基础的重绑定工具；
B）使用功能强大的外部工具，但之后可能会忘记或难以管理这些外部重绑定，尤其是需要在游戏内菜单和游戏主体间保持一致时。

在实现了 SIAPI 的游戏中，这些问题得到了解决。Steam Input 的配置能力远比大多数游戏内方案强大，而当动作与按钮解绑并重新绑定时，游戏内提示（button prompts）可以自动与玩家的自定义绑定同步。把“跳跃”绑定为某个按键，而不是把“某个按键”绑定为跳跃，能让界面提示与玩家绑定保持一致。

一个良好的 SIAPI 实现还能自动根据上下文切换动作集（Action Set）。稍后第 4 章会详细介绍动作集（Action Sets），但要点是动作集可为不同上下文（如菜单、普通行走、驾驶载具等）提供不同的绑定，从而彻底解决重绑定在不同游戏状态之间的冲突问题。

所以，SIAPI 能为玩家带来无缝的控制器体验，无论他们使用何种控制器以及如何自定义按键。但是有两个限制：

其一，SIAPI 需要在 Steam 平台上使用，也就是说 SIAPI 功能仅限于 Steam 版本的游戏。

其二，作为一项较新的 API，很多开发者未必能或愿意把它实现得很好。糟糕的实现反而可能限制玩家自定义体验，而不是改善它。第后续章节会举例说明两种相反的实现：

* Horizon Zero Dawn 的实现有不足：其对触控板或陀螺的鼠标式输入支持不足，且不支持混合输入（mixed inputs）。此外，它将 Steam 控制器的左触控板硬编码为方向键，限制了玩家自定义。
* No Man’s Sky 则是积极的例子：Hello Games 的实现被认为几乎是 SIAPI 的金标准，拥有为各上下文设计的动作集、丰富的可绑定动作，并且整体运行良好。

## 对开发者的好处

实现 SIAPI 可确保对多种控制器的良好支持，并能在玩家使用手柄时提供更优体验（前提是实现得当）。

但缺点也很现实：SIAPI 作为较新的接口，集成成本可能高于简单地支持 XInput；另外 SIAPI 与 Steamworks 绑定，这意味着只有在 Steam 平台发布的版本才可享用 SIAPI 的全部特性。如果你在其它平台同时发售，就需要考虑为这些平台做额外的输入支持。

因此，有些开发者可能认为实现 SIAPI 的成本高于收益。

补充一点：许多 Steam 控制器与 Steam Input 社区的玩家并不喜欢 Valve 把 SIAPI 绑定到 Steam（而非开源或更普遍的 API）。虽然 SIAPI 带来了很多好处，但对平台的绑定在一定程度上限制了它的普及。
=======
```markdown
# 第 0b 章：Steam Input 简介

## 什么是 Steam Input？

Steam Input 最初作为专门针对 Steam 控制器的 API 与配置工具诞生，名称也相应命名。但当 Valve 开始把配置器开放给其他手柄时，为避免混淆便更名为 Steam Input。如今，Steam Input 不仅支持 Steam 控制器，还支持 Xbox 手柄、索尼的 DualShock 4、DualShock 3（需要通过 PSNow 提供驱动）、DualSense、Switch Pro 控制器，以及许多第三方变体。它也支持使用 DInput 的通用控制器，但用户通常需要先将其输入映射到相应的 Xbox 控制器输入，才能进一步重绑定。

Steam Input 是 Steam 平台上的一款软件工具，当连接受支持的控制器并启用相应支持后，它就是一个功能强大的控制器重绑定和配置套件。借助它，你可以仅凭手柄和一些配置来控制整个 PC。

它包含两个组成部分：一是键盘/鼠标与手柄的模拟（emulation），二是开发者可以在游戏中实现的输入 API（SIAPI），以获得更深度的控制器支持。

我们先从对用户最直接的部分讲起。

## 对用户的基本意义

从玩家角度看，Steam Input 在最基础层面解决了许多 PC 上的控制器兼容性问题。过去我还得借助 MotioninJoy 或 SCPToolkit 来使用 DualShock 3，这些工具虽然能用，但有时不太稳定。如今市面上有更多替代品，但就便利性而言，Steam Input 的体验最为一体化：如果你在 PC 上玩游戏，几乎肯定安装了 Steam；启用支持后，控制器即可工作，省却了别的中间件。

但 Steam Input 不仅仅是基础兼容性工具。配置器允许你为控制器创建各种配置文件：桌面配置用于一般 PC 操作、Big Picture 模式下的配置用于在该界面导航、按游戏的单独配置用于每款游戏的自定义，此外还有“Guide Chord”通用配置（按住 Guide/Home 键可快速切换），便于把媒体控制等公共功能统一管理。第 01 章会更详细介绍这些配置类型。

通过这些配置文件，Steam Input 能让你在 PC 的各个场景中都使用手柄。

不过也存在两个潜在缺点：

1. 需要 Steam 运行，并通过 Steam 启动游戏。你仍可在其他商店购买游戏，但通常需把它们添加到 Steam 并从 Steam 启动。
2. 有些游戏与 Steam Input 不兼容。要让 Steam Input 正常工作，Steam 覆盖层（Overlay）需能注入游戏，且游戏必须接受软件输入。有些游戏阻止覆盖层注入，另一些则拒绝软件输入（知名例子为 Valorant），后者情况下几乎无法用 Steam Input。

第 09 章会讨论一些绕过方法，但并非全部可行。

## 对开发者的基本意义

给开发者的提示：如果你希望玩家在例如 Steam Deck 这类设备上游玩，请确保 Steam 覆盖层可注入并允许 SendInput 等软件输入。正如前述，若游戏的反作弊阻止软件输入，玩家在便携设备上将无法使用 Steam Input。

通常情况下，如果你的游戏在 Steam 上发布，Steam Input 可以帮你处理多种控制器兼容性，因此你未必需要为每种控制器都实现本地支持，但仍然建议在可能时提供原生控制器支持以备玩家未启用 Steam Input。

你可以通过以下方式优化对 Steam Input 的支持：

* 允许玩家选择或从 Steam 拉取按钮提示图标（glyph set）
* 支持混合输入（即 XInput 与鼠标同时工作）

这些做法会帮助希望使用 Steam Input 的玩家获得更好体验。

## SIAPI（Steam Input API）

Valve 还为 Steam Input 提供了一个输入 API（SIAPI），开发者可以在游戏内实现它以让 Steam Input 获得更紧密的集成。与 XInput（定义一组按钮与轴）不同，SIAPI 的设计是让开发者定义“动作”（action），例如“跳跃（Jump）”，然后允许玩家或系统将这些动作绑定到任意输入上。

这带来的优势包括：

* 当玩家重绑定操作时，游戏内的按钮提示会自动更新以匹配玩家的自定义（用户体验一致性）。
* 开发者可为不同上下文实现动作集（Action Sets），并在菜单、行走、载具等情境间自动切换，从而解决在游戏与菜单间重绑定冲突的问题。

当然也有两个限制：

1. SIAPI 仅在 Steam 版本游戏中可用（它依赖 Steamworks）；
2. 作为较新的 API，并非所有开发者都能正确实现它，若实现不佳反而会限制玩家自定义体验。

举例：

* 《地平线：零之曙光》（Horizon Zero Dawn）的实现并不理想：对触控板或陀螺用户没有真正的鼠标样式，且强制把左触控板作为 D-Pad，限制了玩家自定义。
* 相比之下，《无人深空》（No Man's Sky）在 SIAPI 的实现上几乎是范例：覆盖了大量动作集与可绑定动作，运作流畅，是 SIAPI 实现的黄金标准。

总体而言，SIAPI 能为玩家带来更无缝的控制器体验，但它要求游戏在 Steam 平台上并且需要开发者投入一定精力去正确实现。

```
>>>>>>> Stashed changes
